#!/bin/bash

export CI=true
export CODEBUILD=true

export CODEBUILD_PROJECT=${CODEBUILD_BUILD_ID%:$CODEBUILD_LOG_PATH}
export CODEBUILD_BUILD_URL="https://$AWS_DEFAULT_REGION.console.aws.amazon.com/codebuild/home?region=$AWS_DEFAULT_REGION#/builds/$CODEBUILD_BUILD_ID/view/new"

# shellcheck disable=SC2155
IS_MAIN_BRANCH=$(echo "${CODEBUILD_WEBHOOK_TRIGGER?}" | grep -E -i -o 'master|main$')


echo "==> AWS CodeBuild Extra Environment Variables:"
echo "==> CI = $CI"
echo "==> CODEBUILD = $CODEBUILD"
echo "==> CODEBUILD_PROJECT = $CODEBUILD_PROJECT"
echo "==> CODEBUILD_PULL_REQUEST = $CODEBUILD_PULL_REQUEST"
echo "==> CODEBUILD_WEBHOOK_TRIGGER = $CODEBUILD_WEBHOOK_TRIGGER"
echo "==> CODEBUILD_WEBHOOK_HEAD_REF = $CODEBUILD_WEBHOOK_HEAD_REF"
echo "==> CODEBUILD_WEBHOOK_BASE_REF = $CODEBUILD_WEBHOOK_BASE_REF"
echo "==> CODEBUILD_SOURCE_VERSION = $CODEBUILD_SOURCE_VERSION"
echo "==> CODEBUILD_BUILD_IMAGE = $CODEBUILD_BUILD_IMAGE"
echo "==> IS_MAIN_BRANCH = $IS_MAIN_BRANCH"
